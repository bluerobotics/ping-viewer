name: Docs - Build and Deploy

on: [push, pull_request]

jobs:
  build:
    name: Build and deploy docs
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Setup Python 3.8
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Update repositories
        run: |
          sudo apt-get update
          python -m pip install --upgrade pip

      - name: Install dependencies
        run:
          pip install mkdocs-material

      - name: Build MkDocs
        run: |
          mkdocs build
          rm ping-viewer/404.html # Page is broken

      - name: Htmlproofer
        uses: athackst/htmlproofer-action@v0.2.0
        if: false # Waiting for https://github.com/athackst/htmlproofer-action/issues/55 and https://github.com/athackst/htmlproofer-action/issues/54
        with:
          directory: "."
          empty_alt_ignore: true
          ignore_urls: |
            https://fonts.gstatic.com

      - name: Deploy documentation
        if: github.ref == 'refs/heads/docs'
        run:
          mkdocs gh-deploy --force
